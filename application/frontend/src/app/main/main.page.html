<ion-header>
  <ion-toolbar>
    <ion-title size="large">
      <div style="display: flex; align-items: center; gap: 8px;">
        <ion-icon name="dns-outline"></ion-icon>
        Hetzner Dynamic DNS
        @if (current?.ip) {
        <ion-chip color="light" outline>
          <ion-icon name="globe-outline"></ion-icon>
          <ion-label>{{ current.ip }}</ion-label>
        </ion-chip>
        }
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="refresh()" [disabled]="isRefreshing">
        <ion-icon name="refresh-outline" [class.spin]="isRefreshing"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Loading State -->
  @if (isLoading) {
  <ion-grid class="ion-no-padding ion-no-margin loading-skeleton">
    <ion-row>
      @for (i of [1,2,3,4]; track i) {
      <ion-col size="12" size-md="6" size-lg="3">
        <div class="skeleton-card"></div>
      </ion-col>
      }
    </ion-row>
  </ion-grid>
  }

  <!-- Main Content -->
  @if (!isLoading) {
  <ion-grid class="ion-no-padding ion-no-margin">
    <!-- Empty State -->
    @if ((!records || records.length === 0 ) && !showAddForm) {
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-md="8" size-lg="6">
        <div class="empty-state">
          <ion-icon name="dns-outline"></ion-icon>
          <ion-label>
            <h2>No DNS Records Found</h2>
            <p>Create your first DNS record to get started with dynamic DNS management.</p>
          </ion-label>
          <ion-button expand="block" fill="outline" (click)="addRecord()" class="ion-margin-top">
            <ion-label>
              Add Record
            </ion-label>
          </ion-button>
        </div>
      </ion-col>
    </ion-row>
    }

    <!-- DNS Records Grid -->
    @if (records && records.length > 0) {
    <ion-row>
      <!-- Existing DNS Records -->
      @for (record of records; track trackByRecordId($index, record)) {
      <ion-col size="12" size-md="6" size-lg="4">
        <ion-card class="record-card" [class.record-active]="isRecordActive(record)"
          [class.record-inactive]="!isRecordActive(record)">
          <div class="record-status" [class.status-active]="isRecordActive(record)"
            [class.status-inactive]="!isRecordActive(record)">

            <ion-card-header>
              <ion-card-title [color]="isRecordActive(record) ? 'dns-active' : 'dns-inactive'">
                <span>{{ record.name }}.{{ record.domain }}</span>
                <span class="record-type-badge" [style.background]="'var(--ion-color-' + getRecordTypeColor(record.type) + ')'"
                          [style.color]="'var(--ion-color-' + getRecordTypeColor(record.type) + '-contrast)'">
                {{ record.type }}
                </span>
              </ion-card-title>
            </ion-card-header>

            <ion-card-content>
              <ion-card-subtitle>
                <div class="last-updated">
                  <ion-icon name="time-outline"></ion-icon>
                  <span>last update {{ getLastUpdatedText(record.updated_at) }}</span>
                </div>
              </ion-card-subtitle>

              <div class="record-details">
                <div class="detail-item">
                  <ion-icon name="timer-outline"></ion-icon>
                  <span class="detail-label">TTL:</span>
                  <span class="detail-value">{{ record.ttl }}s</span>
                </div>
              </div>
            </ion-card-content>
          </div>
        </ion-card>
      </ion-col>
      }

      <!-- Add New Record Card (Desktop) -->
      <ion-col size="12" size-md="6" size-lg="4" size-xl="3" class="ion-hide-sm-down">
        @if (!showAddForm) {
        <ion-card class="add-record-card" (click)="addRecord()" button>
          <div class="add-content">
            <ion-icon name="add-circle-outline"></ion-icon>
            <div class="add-title">Add New Record</div>
            <div class="add-subtitle">Create a new DNS record</div>
          </div>
        </ion-card>
        }
      </ion-col>
    </ion-row>
    }

    <!-- New Record Form -->
    @if (showAddForm && newRecord) {
    <ion-row class="ion-justify-content-center">
      <ion-col size="12" size-md="8" size-lg="6">
        <ion-card class="new-record-form">
          <div class="form-header">
            <h3 class="form-title">Create New DNS Record</h3>
            <ion-button class="close-button" fill="clear" (click)="cancelAddRecord()">
              <ion-icon name="close-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </div>

          <div class="form-content">
            <!-- Step 1: Hetzner Token -->
            <div class="form-step">
              <div class="step-label">
                <span class="step-number">1</span>
                Hetzner API Token
              </div>
              <ion-item>
                <ion-input type="password" placeholder="Enter your Hetzner API token" [(ngModel)]="newRecord.token"
                  (ionInput)="onFormFieldChange()" fill="outline">
                </ion-input>
              </ion-item>
            </div>

            <!-- Step 2: Zone ID -->
            @if (formSteps.token) {
            <div class="form-step">
              <div class="step-label">
                <span class="step-number">2</span>
                Zone ID
              </div>
              <ion-item>
                <ion-select type="text" placeholder="Enter DNS zone ID"
                  (ionChange)="setZone($event.detail.value); onFormFieldChange()" fill="outline" interface="popover">
                  <ion-select-option *ngFor="let zone of zones" [value]="zone">
                    {{ zone.name }}
                  </ion-select-option>
                </ion-select>
              </ion-item>
            </div>
            }

            <!-- Step 3: Record Type -->
            @if (formSteps.zoneId) {
            <div class="form-step">
              <div class="step-label">
                <span class="step-number">3</span>
                Record Type
              </div>
              <ion-item>
                <ion-select placeholder="Select record type" [(ngModel)]="newRecord.type"
                  (ionChange)="onFormFieldChange()" fill="outline">
                  <ion-select-option value="A">A - IPv4 Address</ion-select-option>
                  <ion-select-option value="AAAA">AAAA - IPv6 Address</ion-select-option>
                  <ion-select-option value="CNAME">CNAME - Canonical Name</ion-select-option>
                  <ion-select-option value="MX">MX - Mail Exchange</ion-select-option>
                  <ion-select-option value="TXT">TXT - Text Record</ion-select-option>
                  <ion-select-option value="NS">NS - Name Server</ion-select-option>
                </ion-select>
              </ion-item>
            </div>
            }

            <!-- Step 4: Record Name -->
            @if (formSteps.type) {
            <div class="form-step">
              <div class="step-label">
                <span class="step-number">4</span>
                Record Name
              </div>
              <ion-item>
                <ion-input type="text" placeholder="e.g., www, mail, api" [(ngModel)]="newRecord.name"
                  (ionInput)="onFormFieldChange()" fill="outline">
                </ion-input>
              </ion-item>
            </div>
            }

            <!-- Step 5: TTL -->
            @if (formSteps.name) {
            <div class="form-step">
              <div class="step-label">
                <span class="step-number">6</span>
                TTL (Time To Live)
              </div>
              <ion-item>
                <ion-select placeholder="Select TTL" [(ngModel)]="newRecord.ttl"
                  (ionSelectionChange)="onFormFieldChange()" fill="outline">
                  <ion-select-option [value]="300">5 minutes (300s)</ion-select-option>
                  <ion-select-option [value]="600">10 minutes (600s)</ion-select-option>
                  <ion-select-option [value]="1800">30 minutes (1800s)</ion-select-option>
                  <ion-select-option [value]="3600">1 hour (3600s)</ion-select-option>
                  <ion-select-option [value]="86400">24 hours (86400s)</ion-select-option>
                </ion-select>
              </ion-item>
            </div>
            }

            <!-- Create Button -->
            @if (formSteps.ttl) {
            <ion-button class="create-button" expand="block" (click)="createRecord()"
              [disabled]="isCreatingRecord || !isFormValid()">
              @if (isCreatingRecord) {
              <ion-spinner name="crescent" slot="start"></ion-spinner>
              Creating Record...
              } @else {
              <ion-icon name="checkmark-outline" slot="start"></ion-icon>
              Create DNS Record
              }
            </ion-button>
            }
          </div>
        </ion-card>
      </ion-col>
    </ion-row>
    }
  </ion-grid>
  }

  <!-- Floating Action Button for Mobile -->
  @if (!showAddForm && records && records.length > 0) {
  <ion-fab class="fab-add ion-hide-md-up" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="addRecord()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  }
</ion-content>
