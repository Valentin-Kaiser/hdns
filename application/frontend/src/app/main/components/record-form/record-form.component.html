<!-- Record Form -->
<ion-row class="ion-justify-content-center">
  <ion-col size="12" size-md="8" size-lg="6">
    <ion-card class="form-card">
      <div class="form-header">
        <h3 class="form-title">DNS Record</h3>
        <ion-button class="close-button" fill="clear" (click)="close()">
          <ion-icon name="close-outline" slot="icon-only"></ion-icon>
        </ion-button>
      </div>

      <div class="form-content">
        <!-- Step 1: Hetzner Token -->
        <div class="form-step">
          <div class="step-label">
            <span class="step-number">1</span>
            Hetzner API Token
          </div>
          <ion-item>
            <ion-input type="password" placeholder="Enter your Hetzner API token" [(ngModel)]="record.token"
              debounce="300" (ionInput)="onFormFieldChange()" fill="outline">
            </ion-input>
          </ion-item>
        </div>

        <!-- Token Error Message -->
        @if (formSteps.token && tokenError) {
        <div class="form-step">
          <ion-item color="danger">
            <ion-icon name="warning-outline" slot="start"></ion-icon>
            <ion-label>
              <p>Invalid API token or no zones found. Please check your Hetzner API token.</p>
            </ion-label>
          </ion-item>
        </div>
        }

        <!-- Step 2: Zone ID -->
        @if (formSteps.token && !tokenError) {
        <div class="form-step">
          <div class="step-label">
            <span class="step-number">2</span>
            Zone ID
          </div>
          <ion-item>
            <ion-select type="text" placeholder="Enter DNS zone ID" [(ngModel)]="record.zone_id"
              (ionChange)="setZone($event.detail.value); onFormFieldChange()" fill="outline" interface="popover">
              <ion-select-option *ngFor="let zone of zones" [value]="zone.id">
                {{ zone.name }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </div>
        }

        <!-- Step 3: Record Name -->
        @if (formSteps.zoneId) {
        <div class="form-step">
          <div class="step-label">
            <span class="step-number">3</span>
            Record Name
          </div>
          <ion-item>
            <ion-input type="text" placeholder="e.g., www, mail, api" [(ngModel)]="record.name"
              (ionInput)="onFormFieldChange()" fill="outline">
            </ion-input>
          </ion-item>
        </div>
        }

        <!-- Step 4: TTL (optional) -->
        @if (formSteps.name) {
        <div class="form-step">
          <div class="step-label">
            <span class="step-number">4</span>
            TTL - Time To Live (optional)
          </div>
          <ion-item>
            <ion-input type="number" placeholder="Enter TTL in seconds" [(ngModel)]="record.ttl"
              (ionInput)="onFormFieldChange()" fill="outline" min="60" step="60">
            </ion-input>
          </ion-item>
        </div>
        }

        <!-- Create Button -->
        @if (formSteps.name) {
        <ion-button class="create-button" expand="block" (click)="submit()" [disabled]="!isFormValid()">
          @if (loading) {
          <ion-spinner name="crescent" slot="start"></ion-spinner>
          Saving Record...
          } @else {
          <ion-icon name="checkmark-outline" slot="start"></ion-icon>
          Save DNS Record
          }
        </ion-button>
        }
      </div>
    </ion-card>
  </ion-col>
</ion-row>
